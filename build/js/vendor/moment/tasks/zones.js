var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function i(){u(n,function(){e.log.writeln("Resetting timezone back to "+n),r()})}function s(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n,r){t(n.stdout.replace("Time Zone: ",""))})}function o(t){e.utils.spawn({cmd:"systemsetup",args:["listtimezones"]},function(e,n,r){var i=n.stdout.replace("Time Zones:","");i=i.match(/\S+/g),t(i)})}function u(t,n){e.utils.spawn({cmd:"systemsetup",args:["settimezone",t]},function(e,t,r){n()})}function a(e){var n=t.pop();n?u(n,function(){f(n,function(){a(e)})}):e()}function f(t,n){e.utils.spawn({cmd:"grunt",args:["zone"]},function(e,t,r){if(e)throw i(),e;console.log(t.stdout),n()})}var t,n,r;e.registerTask("zones","Run the unit tests in different timezones.",function(){r=this.async(),s(function(e){n=e,o(function(e){t=e,a(function(){i()})})})})};