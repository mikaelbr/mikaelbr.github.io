var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function a(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n,r){t(n.stdout.replace("Time Zone: ",""))})}function f(e,t){nodeunit.runFiles([path.join(process.cwd(),"test/moment"),path.join(process.cwd(),"test/lang")],{testDone:function(t,n){n.failures()&&i.push([e,t,n])},done:function(n){h(e,n),t()}})}function l(){var n,r=0;for(n=0;n<t.length;n++)r=Math.max(r,t[n].length+2);s[1]=r,e.log.writetableln(s,["","Zone","Offset","Pass","Fail"])}function c(t,n,r){e.log.writeln(""),e.log.error(t+" failed: "+n),r.forEach(function(t){var n=t.error;t.failed()&&(t.message&&e.log.error(t.message),n&&n.actual&&n.expected&&n.operator&&e.log.error([n.actual,n.operator,n.expected].join(" ")))})}function h(t,n){var r=n.failures(),i=n.length-r,a=r?"XX".red:"OK".green,f=i+" passed",l=r?(r+" failed").red:r+" failed",c=""+ -moment().zone()/60;e.log.writetableln(s,[a,c,t,f,l]),r?o++:u++}function p(){var t;if(!o)return;e.log.writeln(o+" failures");for(t=0;t<i.length;t++)c.apply(null,i[t])}var t,n,r=[],i=[],s=[4,6,46,12,12],o=0,u=0;e.registerTask("zone","Run the unit tests in the current timezone.",function(){var e=this.async();a(function(t){f(t,function(){p(),e()})})})};