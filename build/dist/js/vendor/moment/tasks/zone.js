var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n,r){t(n.stdout.replace("Time Zone: ",""))})}function n(e,t){nodeunit.runFiles([path.join(process.cwd(),"test/moment"),path.join(process.cwd(),"test/lang")],{testDone:function(t,n){n.failures()&&l.push([e,t,n])},done:function(n){s(e,n),t()}})}function r(){var t,n=0;for(t=0;t<u.length;t++)n=Math.max(n,u[t].length+2);c[1]=n,e.log.writetableln(c,["","Zone","Offset","Pass","Fail"])}function i(t,n,r){e.log.writeln(""),e.log.error(t+" failed: "+n),r.forEach(function(t){var n=t.error;t.failed()&&(t.message&&e.log.error(t.message),n&&n.actual&&n.expected&&n.operator&&e.log.error([n.actual,n.operator,n.expected].join(" ")))})}function s(t,n){var r=n.failures(),i=n.length-r,s=r?"XX".red:"OK".green,o=i+" passed",u=r?(r+" failed").red:r+" failed",a=""+ -moment().zone()/60;e.log.writetableln(c,[s,a,t,o,u]),r?h++:p++}function o(){var t;if(!h)return;e.log.writeln(h+" failures");for(t=0;t<l.length;t++)i.apply(null,l[t])}var u,a,f=[],l=[],c=[4,6,46,12,12],h=0,p=0;e.registerTask("zone","Run the unit tests in the current timezone.",function(){var e=this.async();t(function(t){n(t,function(){o(),e()})})})};