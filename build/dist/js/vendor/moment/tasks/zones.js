var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(){i(a,function(){e.log.writeln("Resetting timezone back to "+a),f()})}function n(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n,r){t(n.stdout.replace("Time Zone: ",""))})}function r(t){e.utils.spawn({cmd:"systemsetup",args:["listtimezones"]},function(e,n,r){var i=n.stdout.replace("Time Zones:","");i=i.match(/\S+/g),t(i)})}function i(t,n){e.utils.spawn({cmd:"systemsetup",args:["settimezone",t]},function(e,t,r){n()})}function s(e){var t=u.pop();t?i(t,function(){o(t,function(){s(e)})}):e()}function o(n,r){e.utils.spawn({cmd:"grunt",args:["zone"]},function(e,n,i){if(e)throw t(),e;console.log(n.stdout),r()})}var u,a,f;e.registerTask("zones","Run the unit tests in different timezones.",function(){f=this.async(),n(function(e){a=e,r(function(e){u=e,s(function(){t()})})})})};